<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveSell Iframe</title>
    <style>
      html {
        margin: 0;
        padding: 0;
        height: 100vh;
      }

      body {
        margin: 0;
        padding: 0;
        height: 100%;
        max-height: 100%;
        float: left;
        width: 100%;
        position: relative; /* Or any other positioning you need */
        /* overflow: hidden; */
      }
    </style>
 
     <!-- Styles  -->

     <style>    
      #livesell-overlay-modal {
        position: fixed;
        z-index: 1000000000000;
        height: 100%;
        width: 100vw;
        bottom: 0px;
        left: 0px;
        display: none;
        overscroll-behavior: none;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.5);
      }

      .livesell-floating-modal {
        width: 320px !important;
        height: 180px !important;
        left: 10px !important;
        bottom: 10px !important;
        border-radius: 6px !important;
        overflow: hidden !important;
      }


      #livesell-overlay-inner-div {
        height: 92%;
        width: 92%;
      }

      #livesell-checkout-modal {
        position: fixed;
        z-index: 1000000000;
        height: 100%;
        width: 100vw;
        top: 0px;
        left: 0px;
        display: none;
        overscroll-behavior: none;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.5);
      }

      @keyframes livesell-spinner {
        0% {
          transform: translate3d(-50%, -50%, 0) rotate(0deg);
        }
        100% {
          transform: translate3d(-50%, -50%, 0) rotate(360deg);
        }
      }

      .livesell-spin::before {
        animation: 1.5s linear infinite livesell-spinner;
        animation-play-state: inherit;
        border: solid 5px #cfd0d1;
        border-bottom-color: #3a3a3a;
        border-radius: 50%;
        content: "";
        height: 40px;
        width: 40px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate3d(-50%, -50%, 0);
        will-change: transform;
      }

      #livesell-modal-iframe {
        position: relative;
        z-index: 10000000;
        border-radius: 6px;
        overflow: hidden;
      }

    </style>
  
    <script>

      // Event listener to receive messages from the iframe
      let eventListener = window.addEventListener('message', (event) => {
        console.log("LiveSell Event", event)
        const meetingIframe = window.document.getElementById("livesell-modal-iframe");

        
        if(event.data.actionType === "CHECKOUT_PAGE") {
          const modalDiv = window.document.getElementById('livesell-checkout-modal');
          const iframe = window.document.getElementById("livesell-checkout-iframe");
          const meetingDiv = window.document.getElementById('livesell-overlay-modal');
          const meetingInnerDiv = window.document.getElementById('livesell-overlay-inner-div');
          
          if(event.data.action === "OPEN") {
            meetingIframe.contentWindow.postMessage({data: "server", code: event.data.code}, '*')
            iframe.src = event.data.url
            modalDiv.style.display = "flex"
            meetingDiv.classList.add("livesell-floating-modal")
            meetingInnerDiv.style.width = "100%"
            meetingInnerDiv.style.height = "100%"

          } 
          else {
            modalDiv.style.display = "none"
            meetingDiv.classList.remove("livesell-floating-modal")
            meetingInnerDiv.style.width = null
            meetingInnerDiv.style.height = null
          }

          return
        }

        const modalDiv = window.document.getElementById('livesell-overlay-modal');
        const iframe = window.document.getElementById("livesell-modal-iframe");
        if(event.data.fullscreen) {
          iframe.src = "https://rohitkadam.oghanna.com/xsi-waqu-zog?autoJoin=true&userName=" + event.data.userName
          modalDiv.style.display = "flex"
          document.body.style.overflow = "hidden"
        } 
        else if(event.data.fullscreen === false) {
          document.body.style.overflow = null // UPDATE TO: Parent site overlay property
          modalDiv.style.display = "none"
          iframe.src = ""
        }
      });

    </script>

  </head>
  <body >
    <main>
      <div style="width: 100%; height: 200px; background-color: blueviolet"></div>

      <iframe
            width="100%"
            height="550px"
            allow="camera; microphone; fullscreen"
            src="https://rohitkadam.oghanna.com/xsi-waqu-zog?iframe=true"
            frameborder="0"
            allowfullscreen=""
          >
      </iframe>
      
      <div style="width: 100%; height: 200px; background-color: blueviolet"></div>
    </main>

    <div id="livesell-overlay-modal">
      <div id="livesell-overlay-inner-div">
        <div class="livesell-spin"></div>
        <iframe id="livesell-modal-iframe" width="100%" height="100%" allow="camera; microphone; fullscreen" frameborder="0"
        allowfullscreen="">
        </iframe>
      </div>
    </div>

    <div id="livesell-checkout-modal">
      <!-- <div id="livesell-spin"></div> -->
      <iframe id="livesell-checkout-iframe" width="100%" height="100%" allow="" frameborder="0"
        allowfullscreen="">
      </iframe>
    </div>

    </body>
</html>
